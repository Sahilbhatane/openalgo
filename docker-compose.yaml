# ==============================================================================
# OpenAlgo Docker Compose Configuration
# ==============================================================================
# Usage:
#   docker-compose up -d          # Start services
#   docker-compose down           # Stop services
#   docker-compose logs -f        # View logs
# ==============================================================================

services:
  openalgo:
    build:
      context: .
      dockerfile: Dockerfile
    image: openalgo:latest
    container_name: openalgo-app

    # Load environment variables from .env file
    env_file:
      - .env

    # Port mapping
    ports:
      - "${APP_PORT:-8000}:8000"

    # Persistent volumes for logs, data, and reports
    volumes:
      - openalgo_logs:/app/logs
      - openalgo_data:/app/data
      - openalgo_reports:/app/reports
      - openalgo_db:/app/db
      - ./keys:/app/keys:ro

    # Environment variables (can override .env)
    environment:
      - APP_ENV=${APP_ENV:-production}
      - LOG_LEVEL=${LOG_LEVEL:-info}

    # Restart policy
    restart: unless-stopped

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Resource limits (optional, uncomment if needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 1G
    #     reservations:
    #       cpus: '0.5'
    #       memory: 512M

    # Network configuration
    networks:
      - openalgo-network

# Named volumes for data persistence
volumes:
  openalgo_logs:
    driver: local
  openalgo_data:
    driver: local
  openalgo_reports:
    driver: local
  openalgo_db:
    driver: local

# Network configuration
networks:
  openalgo-network:
    driver: bridge
